<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">


<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    
    <title>The Cannon: Data-Driven Stellar Labels &mdash; TheCannon 1.0 documentation</title>
    
    <link rel="stylesheet" href="_static/default.css" type="text/css" />
    <link rel="stylesheet" href="_static/pygments.css" type="text/css" />
    
    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    './',
        VERSION:     '1.0',
        COLLAPSE_INDEX: false,
        FILE_SUFFIX: '.html',
        HAS_SOURCE:  true
      };
    </script>
    <script type="text/javascript" src="_static/jquery.js"></script>
    <script type="text/javascript" src="_static/underscore.js"></script>
    <script type="text/javascript" src="_static/doctools.js"></script>
    <script type="text/javascript" src="http://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>
    <link rel="top" title="TheCannon 1.0 documentation" href="#" /> 
  </head>
  <body>
    <div class="related">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="genindex.html" title="General Index"
             accesskey="I">index</a></li>
        <li><a href="#">TheCannon 1.0 documentation</a> &raquo;</li> 
      </ul>
    </div>  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body">
            
  <div class="section" id="the-cannon-data-driven-stellar-labels">
<h1><em>The Cannon</em>: Data-Driven Stellar Labels<a class="headerlink" href="#the-cannon-data-driven-stellar-labels" title="Permalink to this headline">¶</a></h1>
<div class="section" id="introduction">
<h2>Introduction<a class="headerlink" href="#introduction" title="Permalink to this headline">¶</a></h2>
<p>This is the software package used for <em>The Cannon</em>,
a data-driven approach to determining stellar labels (parameters
and abundances) for a vast set of stellar spectra. This version is tailored
specifically for APOGEE spectra.</p>
<p>A brief overview of <em>The Cannon</em> and the associated software package is below.
For more details on the method and its successful application to APOGEE DR10
spectra, see Ness et al. 2015.</p>
<div class="section" id="introduction-to-the-cannon">
<h3>Introduction to <em>The Cannon</em><a class="headerlink" href="#introduction-to-the-cannon" title="Permalink to this headline">¶</a></h3>
<p><em>The Cannon</em> has two fundamental steps that together constitutes a
process of <em>label transfer.</em></p>
<ol class="arabic simple">
<li>The <em>Training Step</em>: <em>reference objects</em> are a subset of spectra in the
survey for which corresponding stellar labels are known with high fidelity,
for calib reasons or otherwise. Using both the spectra and labels for
these objects, <em>The Cannon</em> solves for a flexible model that describes
how the flux in every pixel of any given continuum-normalized spectrum
depends on labels.</li>
<li>The <em>Test Step</em>: the model found in Step 1 is assumed to hold for all of
the objects in the survey, including those outside the training set
(dubbed <em>survey objects</em>). Thus, the spectra of the survey objects and
the model allow us to solve for - or infer - the labels of the survey
objects.</li>
</ol>
</div>
<div class="section" id="a-word-on-spectra">
<h3>A Word on Spectra<a class="headerlink" href="#a-word-on-spectra" title="Permalink to this headline">¶</a></h3>
<p><em>The Cannon</em> expects all spectra - for reference and survey objects -
to be continuum-normalized in a consistent way, and sampled on a consistent
rest-frame wavelength grid, with the same line-spread function. It also
assumes that the flux variance, from photon noise and other sources, is
known at each spectral pixel of each spectrum.</p>
</div>
<div class="section" id="overview-of-the-cannon-software">
<h3>Overview of <em>The Cannon</em> Software<a class="headerlink" href="#overview-of-the-cannon-software" title="Permalink to this headline">¶</a></h3>
<p>This software package breaks up <em>The Cannon</em> into the following steps and
features.</p>
<ol class="arabic simple">
<li>Construct a training set from APOGEE files<ul>
<li><tt class="docutils literal"><span class="pre">read_apogee</span></tt>: retrieve continuum-normalized training spectra
and (optional) select a subset of spectra.</li>
<li><tt class="docutils literal"><span class="pre">read_labels</span></tt>: retrieve training label names and values
and (optional) select a subset of labels.</li>
<li>Run a set of diagnostics on the training set</li>
</ul>
</li>
<li>Construct a test set from APOGEE files<ul>
<li><tt class="docutils literal"><span class="pre">read_apogee</span></tt>: retrieve continuum-normalized test spectra
and (optional) select a subset of spectra.</li>
</ul>
</li>
<li>Step 1 of The Cannon: fit for a model<ul>
<li>Run a set of diagnostics on the model</li>
</ul>
</li>
<li>Step 2 of The Cannon: infer labels for all test objects<ul>
<li>Run a set of diagnostics on the inferred labels</li>
<li>Run a set of diagnostics on the best-fit spectra</li>
</ul>
</li>
</ol>
</div>
</div>
<div class="section" id="using-the-cannon">
<h2>Using <em>The Cannon</em><a class="headerlink" href="#using-the-cannon" title="Permalink to this headline">¶</a></h2>
<p>The details of using The Cannon package are provided in the following
sections, along with the following example: 553 open and globular cluster stars
from APOGEE DR10 as the training set, and, for simplicity, the same set of stars
as the test set.</p>
<div class="section" id="step-1-construct-a-training-set-from-apogee-files-apogee-py">
<h3>Step 1: Construct a training set from APOGEE files (<tt class="docutils literal"><span class="pre">apogee.py</span></tt>)<a class="headerlink" href="#step-1-construct-a-training-set-from-apogee-files-apogee-py" title="Permalink to this headline">¶</a></h3>
<p>The training set is a set of stars from the survey under consideration
for which the user has spectra and also high-fidelity labels (that is,
stellar parameters and element abundances that are deemed both accurate
and precise.) The set of reference objects is critical, as the label
transfer to the survey objects can only be as good as the quality of the
training set.</p>
<p>The user must construct the following inputs:</p>
<ol class="arabic simple">
<li>a list of filenames corresponding to the training data
(in this case, APOGEE .fits files)</li>
<li>a .txt file containing training labels in an ASCII table.</li>
</ol>
<p>The following requirements govern (2):
1. The first row must be strings corresponding to the names of the labels</p>
<blockquote>
<div>and must not contain any &#8216;/&#8217;s</div></blockquote>
<ol class="arabic simple" start="2">
<li>The first column must be string corresponding to the stellar IDs</li>
<li>The remaining entries must be floats corresponding to the label values</li>
</ol>
<p>In our example, the label file is called <tt class="docutils literal"><span class="pre">traininglabels.txt</span></tt> and the ID
column happens to correspond to the file names that we want to read spectra
from.</p>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="kn">import</span> <span class="nn">numpy</span> <span class="kn">as</span> <span class="nn">np</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">readin</span> <span class="o">=</span> <span class="s">&quot;traininglabels.txt&quot;</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">IDs</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">loadtxt</span><span class="p">(</span><span class="n">readin</span><span class="p">,</span> <span class="n">usecols</span><span class="o">=</span><span class="p">(</span><span class="mi">0</span><span class="p">,),</span> <span class="n">dtype</span><span class="o">=</span><span class="s">&#39;string&#39;</span><span class="p">,</span> <span class="n">unpack</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">filenames1</span> <span class="o">=</span> <span class="p">[]</span>
<span class="gp">&gt;&gt;&gt; </span><span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">IDs</span><span class="p">)):</span> <span class="c">#incorporate file location info</span>
<span class="go">    ...filename = &#39;/home/annaho/AnnaCannon/Data/APOGEE_Data&#39; + IDs[i][1:]</span>
<span class="go">    ...filenames1.append(filename)</span>
</pre></div>
</div>
<p>Once the file list is created, the <tt class="docutils literal"><span class="pre">get_spectra</span></tt> method can be
used to put the spectrum information into the correct format.</p>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="kn">from</span> <span class="nn">read_apogee</span> <span class="kn">import</span> <span class="n">get_spectra</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">spectra</span><span class="p">,</span> <span class="n">SNRs</span> <span class="o">=</span> <span class="n">get_spectra</span><span class="p">(</span><span class="n">filenames1</span><span class="p">)</span>
</pre></div>
</div>
<p>Now the <tt class="docutils literal"><span class="pre">get_training_labels</span></tt> method is used to retrieve IDs, label names,
and label values.</p>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="kn">from</span> <span class="nn">read_labels</span> <span class="kn">import</span> <span class="n">get_training_labels</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">IDs</span><span class="p">,</span> <span class="n">all_label_names</span><span class="p">,</span> <span class="n">all_label_values</span> <span class="o">=</span> <span class="n">get_training_labels</span><span class="p">(</span><span class="n">readin</span><span class="p">)</span>
</pre></div>
</div>
<p>(Optional) The user can choose to select some subset of the training labels
by creating a mask corresponding to the desired column indices.
In this example, we select Teff, logg, and [Fe/H].</p>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="n">cols</span> <span class="o">=</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">5</span><span class="p">]</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">colmask</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">all_label_names</span><span class="p">),</span> <span class="n">dtype</span><span class="o">=</span><span class="nb">bool</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">colmask</span><span class="p">[</span><span class="n">cols</span><span class="p">]</span> <span class="o">=</span> <span class="mi">1</span>
</pre></div>
</div>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="n">label_names</span> <span class="o">=</span> <span class="p">[</span><span class="n">all_label_names</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">cols</span><span class="p">]</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">label_values</span> <span class="o">=</span> <span class="n">all_label_values</span><span class="p">[:,</span><span class="n">colmask</span><span class="p">]</span>
</pre></div>
</div>
<p>The user can also (if desired) select some subset of the training objects, by
imposing physical cutoffs. Here, we select data with physical
Teff and logg cutoffs.</p>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="n">Teff</span> <span class="o">=</span> <span class="n">label_values</span><span class="p">[:,</span><span class="mi">0</span><span class="p">]</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">Teff_corr</span> <span class="o">=</span> <span class="n">all_label_values</span><span class="p">[:,</span><span class="mi">2</span><span class="p">]</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">diff_t</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">Teff</span><span class="o">-</span><span class="n">Teff_corr</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">diff_t_cut</span> <span class="o">=</span> <span class="mf">600.</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">logg</span> <span class="o">=</span> <span class="n">label_values</span><span class="p">[:,</span><span class="mi">1</span><span class="p">]</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">logg_cut</span> <span class="o">=</span> <span class="mf">100.</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">bad</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">logical_and</span><span class="p">((</span><span class="n">diff_t</span> <span class="o">&lt;</span> <span class="n">diff_t_cut</span><span class="p">),</span> <span class="n">logg</span> <span class="o">&lt;</span> <span class="n">logg_cut</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">IDs</span> <span class="o">=</span> <span class="n">IDs</span><span class="p">[</span><span class="n">bad</span><span class="p">]</span>
<span class="go">&gt;&gt;&gt;</span>
</pre></div>
</div>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="n">dataset</span> <span class="kn">import</span> <span class="nn">Dataset</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">fts_trainingset</span> <span class="o">=</span> <span class="n">Dataset</span><span class="p">(</span><span class="n">objectIDs</span> <span class="o">=</span> <span class="p">[],</span> <span class="n">spectra</span> <span class="o">=</span> <span class="p">[],</span> <span class="n">labelnames</span> <span class="o">=</span> <span class="p">[],</span> <span class="n">labelvals</span> <span class="o">=</span> <span class="p">[])</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">vesta_trainingset</span> <span class="o">=</span> <span class="n">Dataset</span><span class="p">(</span><span class="n">objectIDs</span> <span class="o">=</span> <span class="p">[],</span> <span class="n">spectra</span> <span class="o">=</span> <span class="p">[],</span> <span class="n">labelnames</span> <span class="o">=</span> <span class="p">[],</span> <span class="n">labelvals</span> <span class="o">=</span> <span class="p">[])</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">cluster_trainingset</span> <span class="o">=</span> <span class="n">Dataset</span><span class="p">(</span><span class="n">objectIDs</span> <span class="o">=</span> <span class="p">[],</span> <span class="n">spectra</span> <span class="o">=</span> <span class="p">[],</span> <span class="n">labelnames</span> <span class="o">=</span> <span class="p">[],</span> <span class="n">labelvals</span> <span class="o">=</span> <span class="p">[])</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">trainingset</span> <span class="o">=</span> <span class="n">mergesets</span><span class="p">(</span><span class="n">fts_trainingset</span><span class="p">,</span> <span class="n">vesta_trainingset</span><span class="p">,</span> <span class="n">cluster_trainingset</span><span class="p">)</span>
</pre></div>
</div>
<p>There are a few ways to examine the dataset. You can retrieve the spectra
as follows:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="n">pixels</span> <span class="o">=</span> <span class="n">trainingset</span><span class="o">.</span><span class="n">spectra</span><span class="p">[:,:,</span><span class="mi">0</span><span class="p">]</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">fluxes</span> <span class="o">=</span> <span class="n">trainingset</span><span class="o">.</span><span class="n">spectra</span><span class="p">[:,:,</span><span class="mi">1</span><span class="p">]</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">fluxerrs</span> <span class="o">=</span> <span class="n">trainingset</span><span class="o">.</span><span class="n">spectra</span><span class="p">[:,:,</span><span class="mi">2</span><span class="p">]</span>
</pre></div>
</div>
</div>
<div class="section" id="step-3-construct-test-set">
<h3>Step 3: Construct Test Set<a class="headerlink" href="#step-3-construct-test-set" title="Permalink to this headline">¶</a></h3>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="n">testset</span> <span class="o">=</span> <span class="n">Dataset</span><span class="p">(</span><span class="n">objectIDs</span> <span class="o">=</span> <span class="p">[],</span> <span class="n">spectra</span> <span class="o">=</span> <span class="p">[],</span> <span class="n">labelnames</span> <span class="o">=</span> <span class="p">[],</span> <span class="n">labelvals</span> <span class="o">=</span> <span class="bp">None</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="section" id="step-4-the-cannon-step-1-generate-model">
<h3>Step 4: <em>The Cannon</em> Step 1 - Generate Model<a class="headerlink" href="#step-4-the-cannon-step-1-generate-model" title="Permalink to this headline">¶</a></h3>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="kn">from</span> <span class="nn">spectral_model</span> <span class="kn">import</span> <span class="n">SpectralModel</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">model</span> <span class="o">=</span> <span class="n">SpectralModel</span><span class="p">(</span><span class="n">label_names</span><span class="p">,</span> <span class="n">modeltype</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">model</span><span class="o">.</span><span class="n">train</span><span class="p">(</span><span class="n">trainingset</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="section" id="step-5-the-cannon-step-2-infer-labels">
<h3>Step 5: <em>The Cannon</em> Step 2 - Infer Labels<a class="headerlink" href="#step-5-the-cannon-step-2-infer-labels" title="Permalink to this headline">¶</a></h3>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="kn">from</span> <span class="nn">cannon_labels</span> <span class="kn">import</span> <span class="n">CannonLabels</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">labels</span> <span class="o">=</span> <span class="n">CannonLabels</span><span class="p">(</span><span class="n">label_names</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">labels</span><span class="o">.</span><span class="n">solve</span><span class="p">(</span><span class="n">model</span><span class="p">,</span> <span class="n">testset</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
</div>


          </div>
        </div>
      </div>
      <div class="sphinxsidebar">
        <div class="sphinxsidebarwrapper">
  <h3><a href="#">Table Of Contents</a></h3>
  <ul>
<li><a class="reference internal" href="#"><em>The Cannon</em>: Data-Driven Stellar Labels</a><ul>
<li><a class="reference internal" href="#introduction">Introduction</a><ul>
<li><a class="reference internal" href="#introduction-to-the-cannon">Introduction to <em>The Cannon</em></a></li>
<li><a class="reference internal" href="#a-word-on-spectra">A Word on Spectra</a></li>
<li><a class="reference internal" href="#overview-of-the-cannon-software">Overview of <em>The Cannon</em> Software</a></li>
</ul>
</li>
<li><a class="reference internal" href="#using-the-cannon">Using <em>The Cannon</em></a><ul>
<li><a class="reference internal" href="#step-1-construct-a-training-set-from-apogee-files-apogee-py">Step 1: Construct a training set from APOGEE files (<tt class="docutils literal"><span class="pre">apogee.py</span></tt>)</a></li>
<li><a class="reference internal" href="#step-3-construct-test-set">Step 3: Construct Test Set</a></li>
<li><a class="reference internal" href="#step-4-the-cannon-step-1-generate-model">Step 4: <em>The Cannon</em> Step 1 - Generate Model</a></li>
<li><a class="reference internal" href="#step-5-the-cannon-step-2-infer-labels">Step 5: <em>The Cannon</em> Step 2 - Infer Labels</a></li>
</ul>
</li>
</ul>
</li>
</ul>

  <h3>This Page</h3>
  <ul class="this-page-menu">
    <li><a href="_sources/index.txt"
           rel="nofollow">Show Source</a></li>
  </ul>
<div id="searchbox" style="display: none">
  <h3>Quick search</h3>
    <form class="search" action="search.html" method="get">
      <input type="text" name="q" />
      <input type="submit" value="Go" />
      <input type="hidden" name="check_keywords" value="yes" />
      <input type="hidden" name="area" value="default" />
    </form>
    <p class="searchtip" style="font-size: 90%">
    Enter search terms or a module, class or function name.
    </p>
</div>
<script type="text/javascript">$('#searchbox').show(0);</script>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="related">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="genindex.html" title="General Index"
             >index</a></li>
        <li><a href="#">TheCannon 1.0 documentation</a> &raquo;</li> 
      </ul>
    </div>
    <div class="footer">
        &copy; Copyright 2015, Anna Ho.
      Created using <a href="http://sphinx-doc.org/">Sphinx</a> 1.2.3.
    </div>
  </body>
</html>