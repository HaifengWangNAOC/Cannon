<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">


<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    
    <title>The Cannon: Data-Driven Stellar Labels &mdash; TheCannon 1.0 documentation</title>
    
    <link rel="stylesheet" href="_static/default.css" type="text/css" />
    <link rel="stylesheet" href="_static/pygments.css" type="text/css" />
    
    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    './',
        VERSION:     '1.0',
        COLLAPSE_INDEX: false,
        FILE_SUFFIX: '.html',
        HAS_SOURCE:  true
      };
    </script>
    <script type="text/javascript" src="_static/jquery.js"></script>
    <script type="text/javascript" src="_static/underscore.js"></script>
    <script type="text/javascript" src="_static/doctools.js"></script>
    <script type="text/javascript" src="http://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>
    <link rel="top" title="TheCannon 1.0 documentation" href="#" /> 
  </head>
  <body>
    <div class="related">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="genindex.html" title="General Index"
             accesskey="I">index</a></li>
        <li><a href="#">TheCannon 1.0 documentation</a> &raquo;</li> 
      </ul>
    </div>  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body">
            
  <div class="section" id="the-cannon-data-driven-stellar-labels">
<h1><em>The Cannon</em>: Data-Driven Stellar Labels<a class="headerlink" href="#the-cannon-data-driven-stellar-labels" title="Permalink to this headline">¶</a></h1>
<div class="section" id="introduction">
<h2>Introduction<a class="headerlink" href="#introduction" title="Permalink to this headline">¶</a></h2>
<p>This is the software package used for <em>The Cannon</em>,
a data-driven approach to determining stellar labels (parameters
and abundances) for a vast set of stellar spectra. This version is tailored
specifically for APOGEE spectra.</p>
<p>A brief overview of <em>The Cannon</em> and the associated software package is below.
For more details on the method and its successful application to APOGEE DR10
spectra, see Ness et al. 2015.</p>
<div class="section" id="introduction-to-the-cannon">
<h3>Introduction to <em>The Cannon</em><a class="headerlink" href="#introduction-to-the-cannon" title="Permalink to this headline">¶</a></h3>
<p><em>The Cannon</em> has two fundamental steps that together constitute a
process of <em>label transfer.</em></p>
<ol class="arabic simple">
<li>The <em>Training Step</em>: <em>reference objects</em> are a subset of spectra in the
survey for which corresponding stellar labels are known with high fidelity,
for calib reasons or otherwise. Using both the spectra and labels for
these objects, <em>The Cannon</em> solves for a flexible model that describes
how the flux in every pixel of any given continuum-normalized spectrum
depends on labels.</li>
<li>The <em>Test Step</em>: the model found in Step 1 is assumed to hold for all of
the objects in the survey, including those outside the training set
(dubbed <em>survey objects</em>). Thus, the spectra of the survey objects and
the model allow us to solve for - or infer - the labels of the survey
objects.</li>
</ol>
</div>
<div class="section" id="overview-of-the-cannon-software">
<h3>Overview of <em>The Cannon</em> Software<a class="headerlink" href="#overview-of-the-cannon-software" title="Permalink to this headline">¶</a></h3>
<p>This software package breaks up <em>The Cannon</em> into the following steps and methods.</p>
<ol class="arabic simple">
<li>Construct a training set from APOGEE files<ul>
<li><tt class="docutils literal"><span class="pre">get_spectra</span></tt>: read spectra, continuum-normalize</li>
<li><tt class="docutils literal"><span class="pre">get_training_labels</span></tt>: retrieve stellar IDs, training label names and values</li>
<li><tt class="docutils literal"><span class="pre">choose_labels</span></tt>: (optional) select a subset of labels</li>
<li><tt class="docutils literal"><span class="pre">choose_spectra</span></tt>: (optional) select a subset of spectra</li>
<li><tt class="docutils literal"><span class="pre">training_set_diagnostics</span></tt>: (optional) run a set of diagnostics
on the training set</li>
</ul>
</li>
<li>Construct a test set from APOGEE files<ul>
<li><tt class="docutils literal"><span class="pre">get_spectra</span></tt>: read spectra, continuum-normalize</li>
<li><tt class="docutils literal"><span class="pre">choose_spectra</span></tt>: (optional) select a subset of spectra</li>
</ul>
</li>
<li>The Cannon Step 1: Fit Model<ul>
<li><tt class="docutils literal"><span class="pre">train_model</span></tt>: solve for model</li>
<li><tt class="docutils literal"><span class="pre">model_diagnostics</span></tt>: run a set of diagnostics on the model</li>
</ul>
</li>
<li>Step 2 of The Cannon: infer labels for all test objects<ul>
<li><tt class="docutils literal"><span class="pre">infer_labels</span></tt>: infer labels using model</li>
<li><tt class="docutils literal"><span class="pre">test_set_diagnostics</span></tt>: run a set of diagnostics on the inferred labels</li>
</ul>
</li>
<li>Cannon-generated spectra (<tt class="docutils literal"><span class="pre">cannon_spectra</span></tt>)<ul>
<li><tt class="docutils literal"><span class="pre">draw_spectra</span></tt> in <tt class="docutils literal"><span class="pre">cannon_spectra</span></tt></li>
<li><tt class="docutils literal"><span class="pre">diagnostics</span></tt> in <tt class="docutils literal"><span class="pre">cannon_spectra</span></tt></li>
</ul>
</li>
</ol>
</div>
</div>
<div class="section" id="using-the-cannon">
<h2>Using <em>The Cannon</em><a class="headerlink" href="#using-the-cannon" title="Permalink to this headline">¶</a></h2>
<p>The details of using this package are provided in the following
sections, along with an example of usage. In the example, the training set
consists of 553 open and globular cluster stars from APOGEE DR10 and,
for simplicity, the same set of stars as the test set.</p>
<div class="section" id="step-1-construct-a-training-set-from-apogee-files">
<h3>Step 1: Construct a training set from APOGEE files<a class="headerlink" href="#step-1-construct-a-training-set-from-apogee-files" title="Permalink to this headline">¶</a></h3>
<p>The training set is a set of stars from the survey under consideration
for which the user has spectra and also high-fidelity labels (that is,
stellar parameters and element abundances that are deemed both accurate
and precise.) The set of reference objects is critical, as the label
transfer to the survey objects can only be as good as the quality of the
training set.</p>
<p>The user must construct the following inputs:</p>
<ol class="arabic simple">
<li>a list of filenames corresponding to the training data
(in this case, APOGEE .fits files)</li>
<li>a .txt file containing training labels in an ASCII table.</li>
</ol>
<p>The following requirements govern (2):</p>
<ol class="arabic simple">
<li>The first row must be strings corresponding to the names of the labels
and must not contain any &#8216;/&#8217;s</li>
<li>The first column must be strings corresponding to the stellar IDs</li>
<li>The remaining entries must be floats corresponding to the label values</li>
</ol>
<div class="section" id="reading-spectra-get-spectra">
<h4>Reading spectra (<tt class="docutils literal"><span class="pre">get_spectra</span></tt>)<a class="headerlink" href="#reading-spectra-get-spectra" title="Permalink to this headline">¶</a></h4>
<p>We construct the first input: the list of filenames corresponding to the
training data (in this case, APOGEE .fits files). In our example, the filenames
happen to be the first column in the training labels text file,
<tt class="docutils literal"><span class="pre">traininglabels.txt</span></tt>. So we simply read the first column of this file.</p>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="kn">import</span> <span class="nn">numpy</span> <span class="kn">as</span> <span class="nn">np</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">readin</span> <span class="o">=</span> <span class="s">&quot;traininglabels.txt&quot;</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">IDs</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">loadtxt</span><span class="p">(</span><span class="n">readin</span><span class="p">,</span> <span class="n">usecols</span><span class="o">=</span><span class="p">(</span><span class="mi">0</span><span class="p">,),</span> <span class="n">dtype</span><span class="o">=</span><span class="s">&#39;string&#39;</span><span class="p">,</span> <span class="n">unpack</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">filenames1</span> <span class="o">=</span> <span class="p">[]</span>
<span class="gp">&gt;&gt;&gt; </span><span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">IDs</span><span class="p">)):</span> <span class="c">#incorporate file location info</span>
<span class="gp">&gt;&gt;&gt; </span><span class="o">....</span><span class="n">filename</span> <span class="o">=</span> <span class="s">&#39;/home/annaho/AnnaCannon/Data/APOGEE_Data&#39;</span> <span class="o">+</span> <span class="n">IDs</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="mi">1</span><span class="p">:]</span>
<span class="gp">&gt;&gt;&gt; </span><span class="o">....</span><span class="n">filenames1</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">filename</span><span class="p">)</span>
</pre></div>
</div>
<p>Once the file list is created, the <tt class="docutils literal"><span class="pre">get_spectra</span></tt> method can be
used to continuum-normalize the spectrum information and put it
into the correct format. <tt class="docutils literal"><span class="pre">get_spectra</span></tt> also returns the fitted
continua (Chebyshev polynomial) and a list of SNR values for the
spectra.</p>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="kn">from</span> <span class="nn">read_apogee</span> <span class="kn">import</span> <span class="n">get_spectra</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">lambdas</span><span class="p">,</span> <span class="n">normalized_spectra</span><span class="p">,</span> <span class="n">continua</span><span class="p">,</span> <span class="n">SNRs</span> <span class="o">=</span> <span class="n">get_spectra</span><span class="p">(</span><span class="n">filenames1</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="section" id="reading-labels-get-training-labels">
<h4>Reading labels (<tt class="docutils literal"><span class="pre">get_training_labels</span></tt>)<a class="headerlink" href="#reading-labels-get-training-labels" title="Permalink to this headline">¶</a></h4>
<p>We construct the second input: the .txt file containing training labels in an
ASCII table, with requirements described above. In this example, the .txt file
is called <tt class="docutils literal"><span class="pre">traininglabels.txt</span></tt>. The method <tt class="docutils literal"><span class="pre">get_training_labels</span></tt> is used
to retrieve object IDs, label names, and label values.</p>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="kn">from</span> <span class="nn">read_labels</span> <span class="kn">import</span> <span class="n">get_training_labels</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">IDs</span><span class="p">,</span> <span class="n">all_label_names</span><span class="p">,</span> <span class="n">all_label_values</span> <span class="o">=</span> <span class="n">get_training_labels</span><span class="p">(</span><span class="n">readin</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="section" id="creating-tailoring-a-dataset-object-choose-labels-choose-spectra">
<h4>Creating &amp; tailoring a <tt class="docutils literal"><span class="pre">Dataset</span></tt> object (<tt class="docutils literal"><span class="pre">choose_labels</span></tt>, <tt class="docutils literal"><span class="pre">choose_spectra</span></tt>)<a class="headerlink" href="#creating-tailoring-a-dataset-object-choose-labels-choose-spectra" title="Permalink to this headline">¶</a></h4>
<p>A <tt class="docutils literal"><span class="pre">Dataset</span></tt> object (<tt class="docutils literal"><span class="pre">dataset.py</span></tt>) is initialized.</p>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="kn">from</span> <span class="nn">dataset</span> <span class="kn">import</span> <span class="n">Dataset</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">training_set</span> <span class="o">=</span> <span class="n">Dataset</span><span class="p">(</span><span class="n">IDs</span><span class="o">=</span><span class="n">IDs</span><span class="p">,</span> <span class="n">SNRs</span><span class="o">=</span><span class="n">SNRs</span><span class="p">,</span> <span class="n">lambdas</span><span class="o">=</span><span class="n">lambdas</span><span class="p">,</span>
<span class="gp">&gt;&gt;&gt; </span><span class="o">....</span><span class="n">spectra</span><span class="o">=</span><span class="n">normalized_spectra</span><span class="p">,</span> <span class="n">label_names</span><span class="o">=</span><span class="n">all_label_names</span><span class="p">,</span>
<span class="gp">&gt;&gt;&gt; </span><span class="o">....</span><span class="n">label_vals</span><span class="o">=</span><span class="n">all_label_values</span><span class="p">)</span>
</pre></div>
</div>
<p>(Optional) The user can choose to select some subset of the training labels
by creating a list of the desired column indices.
In this example, we select Teff, logg, and [Fe/H] which correspond to
columns 1, 3, and 5.</p>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="n">cols</span> <span class="o">=</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">5</span><span class="p">]</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">training_set</span><span class="o">.</span><span class="n">choose_labels</span><span class="p">(</span><span class="n">cols</span><span class="p">)</span>
</pre></div>
</div>
<p>(Optional) The user can also select some subset of the training objects
(for example, by imposing physical cutoffs) by constructing a mask where
1 = keep this object, and 0 = remove it. Here, we select data using physical
Teff and logg cutoffs.</p>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="n">Teff</span> <span class="o">=</span> <span class="n">training_set</span><span class="o">.</span><span class="n">label_vals</span><span class="p">[:,</span><span class="mi">0</span><span class="p">]</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">Teff_corr</span> <span class="o">=</span> <span class="n">all_label_values</span><span class="p">[:,</span><span class="mi">2</span><span class="p">]</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">diff_t</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">Teff</span><span class="o">-</span><span class="n">Teff_corr</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">diff_t_cut</span> <span class="o">=</span> <span class="mf">600.</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">logg</span> <span class="o">=</span> <span class="n">training_set</span><span class="o">.</span><span class="n">label_vals</span><span class="p">[:,</span><span class="mi">1</span><span class="p">]</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">logg_cut</span> <span class="o">=</span> <span class="mf">100.</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">mask</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">logical_and</span><span class="p">((</span><span class="n">diff_t</span> <span class="o">&lt;</span> <span class="n">diff_t_cut</span><span class="p">),</span> <span class="n">logg</span> <span class="o">&lt;</span> <span class="n">logg_cut</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">training_set</span><span class="o">.</span><span class="n">choose_spectra</span><span class="p">(</span><span class="n">mask</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="section" id="training-set-diagnostics-training-set-diagnostics">
<h4>Training set diagnostics (training_set_diagnostics)<a class="headerlink" href="#training-set-diagnostics-training-set-diagnostics" title="Permalink to this headline">¶</a></h4>
<p>Now, the training set has been constructed. To let the user examine whether
things are going smoothly, <em>The Cannon</em> can print out a set of training set
diagnostics.</p>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="kn">from</span> <span class="nn">dataset</span> <span class="kn">import</span> <span class="n">training_set_diagnostics</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">training_set_diagnostics</span><span class="p">(</span><span class="n">training_set</span><span class="p">)</span>
</pre></div>
</div>
<p>The output of these diagnostics, with examples, are listed below.</p>
<ol class="arabic simple">
<li>A histogram showing the distribution of SNR in the training set</li>
</ol>
<a class="reference internal image-reference" href="_images/trainingset_SNRdist.png"><img alt="_images/trainingset_SNRdist.png" src="_images/trainingset_SNRdist.png" style="width: 400pt;" /></a>
<ol class="arabic simple" start="2">
<li>A histogram for each label showing its coverage in label space</li>
</ol>
<a class="reference internal image-reference" href="_images/trainingset_labeldist_Teff.png"><img alt="_images/trainingset_labeldist_Teff.png" src="_images/trainingset_labeldist_Teff.png" style="width: 400pt;" /></a>
<ol class="arabic simple" start="3">
<li>A &#8220;triangle plot&#8221; that shows every label plotted against every other</li>
</ol>
<a class="reference internal image-reference" href="_images/trainingset_labels_triangle.png"><img alt="_images/trainingset_labels_triangle.png" src="_images/trainingset_labels_triangle.png" style="width: 400pt;" /></a>
</div>
</div>
<div class="section" id="step-2-construct-a-test-set-from-apogee-files">
<h3>Step 2: Construct a test set from APOGEE files<a class="headerlink" href="#step-2-construct-a-test-set-from-apogee-files" title="Permalink to this headline">¶</a></h3>
<p>To construct the test set, the user would ordinarily go through a process
identical to that for the training set, except without reading in the
training labels file.
In this case, for simplicity, we use the training set as our test set.</p>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="n">test_set</span> <span class="o">=</span> <span class="n">Dataset</span><span class="p">(</span><span class="n">IDs</span><span class="o">=</span><span class="n">training_set</span><span class="o">.</span><span class="n">IDs</span><span class="p">,</span> <span class="n">SNRs</span><span class="o">=</span><span class="n">training_set</span><span class="o">.</span><span class="n">SNRs</span><span class="p">,</span>
<span class="gp">&gt;&gt;&gt; </span><span class="o">....</span><span class="n">lambdas</span><span class="o">=</span><span class="n">lambdas</span><span class="p">,</span> <span class="n">spectra</span><span class="o">=</span><span class="n">training_set</span><span class="o">.</span><span class="n">spectra</span><span class="p">,</span>
<span class="gp">&gt;&gt;&gt; </span><span class="o">....</span><span class="n">label_names</span><span class="o">=</span><span class="n">training_set</span><span class="o">.</span><span class="n">label_names</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="section" id="step-3-the-cannon-step-1-fit-model-train-model-model-diagnostics">
<h3>Step 3: <em>The Cannon</em> Step 1 - Fit Model (<tt class="docutils literal"><span class="pre">train_model</span></tt>, <tt class="docutils literal"><span class="pre">model_diagnostics</span></tt>)<a class="headerlink" href="#step-3-the-cannon-step-1-fit-model-train-model-model-diagnostics" title="Permalink to this headline">¶</a></h3>
<p>Now, we use our training set to fit for the model.</p>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="kn">from</span> <span class="nn">cannon1_train_model</span> <span class="kn">import</span> <span class="n">train_model</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">model</span> <span class="o">=</span> <span class="n">train_model</span><span class="p">(</span><span class="n">training_set</span><span class="p">)</span>
</pre></div>
</div>
<p>To let the user examine whether things are going smoothly, <em>The Cannon</em> can
print out a set of model diagnostics.</p>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="kn">from</span> <span class="nn">cannon1_train_model</span> <span class="kn">import</span> <span class="n">model_diagnostics</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">model_diagnostics</span><span class="p">(</span><span class="n">training_set</span><span class="p">,</span> <span class="n">model</span><span class="p">)</span>
</pre></div>
</div>
<p>The output of these diagnostics with sample plots are listed below.</p>
<ol class="arabic simple">
<li>Plot of the baseline spectrum (0th order coefficients) as a
function of wavelength.</li>
</ol>
<a class="reference internal image-reference" href="_images/baseline_spec_with_cont_pix.png"><img alt="_images/baseline_spec_with_cont_pix.png" src="_images/baseline_spec_with_cont_pix.png" style="width: 400pt;" /></a>
<ol class="arabic simple" start="2">
<li>Plot of the leading coefficients of each label as a function
of wavelength</li>
</ol>
<a class="reference internal image-reference" href="_images/leading_coeffs.png"><img alt="_images/leading_coeffs.png" src="_images/leading_coeffs.png" style="width: 400pt;" /></a>
<ol class="arabic simple" start="3">
<li>Histogram of the reduced chi squareds of the fits (normalized by DOF,
where DOF = npixels-nlabels)</li>
</ol>
<a class="reference internal image-reference" href="_images/modelfit_redchisqs.png"><img alt="_images/modelfit_redchisqs.png" src="_images/modelfit_redchisqs.png" style="width: 400pt;" /></a>
</div>
<div class="section" id="step-4-the-cannon-step-2-infer-labels-infer-labels-test-set-diagnostics">
<h3>Step 4: <em>The Cannon</em> Step 2 - Infer Labels (<tt class="docutils literal"><span class="pre">infer_labels</span></tt>, <tt class="docutils literal"><span class="pre">test_set_diagnostics</span></tt>)<a class="headerlink" href="#step-4-the-cannon-step-2-infer-labels-infer-labels-test-set-diagnostics" title="Permalink to this headline">¶</a></h3>
<p>Now, we use the model to infer labels for the survey objects and
update the test_set object.</p>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="kn">from</span> <span class="nn">cannon2_infer_labels</span> <span class="kn">import</span> <span class="n">infer_labels</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">test_set</span><span class="p">,</span> <span class="n">covs</span> <span class="o">=</span> <span class="n">infer_labels</span><span class="p">(</span><span class="n">model</span><span class="p">,</span> <span class="n">test_set</span><span class="p">)</span>
</pre></div>
</div>
<p>To let the user examine whether things are going smoothly, <em>The Cannon</em> can
print out a set of test set diagnostics.</p>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="kn">from</span> <span class="nn">dataset</span> <span class="kn">import</span> <span class="n">test_set_diagnostics</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">test_set_diagnostics</span><span class="p">(</span><span class="n">training_set</span><span class="p">,</span> <span class="n">test_set</span><span class="p">)</span>
</pre></div>
</div>
<p>The output of these diagnostics with sample plots are listed below.</p>
<ol class="arabic simple">
<li>For each label, a list of flagged stars for which test labels are
over 2-sigma away from training labels</li>
<li>Triangle plot, each test label plotted against every other test label</li>
</ol>
<a class="reference internal image-reference" href="_images/testset_labels_triangle.png"><img alt="_images/testset_labels_triangle.png" src="_images/testset_labels_triangle.png" style="width: 400pt;" /></a>
<ol class="arabic simple" start="3">
<li>1-1 plots, for each label, training values plotted against test values</li>
</ol>
<a class="reference internal image-reference" href="_images/1to1_labelTeff.png"><img alt="_images/1to1_labelTeff.png" src="_images/1to1_labelTeff.png" style="width: 300pt;" /></a>
<a class="reference internal image-reference" href="_images/1to1_labellogg.png"><img alt="_images/1to1_labellogg.png" src="_images/1to1_labellogg.png" style="width: 300pt;" /></a>
<a class="reference internal image-reference" href="_images/1to1_label[MH].png"><img alt="_images/1to1_label[MH].png" src="_images/1to1_label[MH].png" style="width: 300pt;" /></a>
</div>
<div class="section" id="cannon-spectra-draw-spectra-diagnostics">
<h3>Cannon Spectra (<tt class="docutils literal"><span class="pre">draw_spectra</span></tt>, <tt class="docutils literal"><span class="pre">diagnostics</span></tt>)<a class="headerlink" href="#cannon-spectra-draw-spectra-diagnostics" title="Permalink to this headline">¶</a></h3>
<p>Now that we have the model and labels for the test objects, <tt class="docutils literal"><span class="pre">The</span> <span class="pre">Cannon</span></tt> can
&#8220;draw&#8221; spectra for each test object.</p>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="kn">from</span> <span class="nn">cannon_spectra</span> <span class="kn">import</span> <span class="n">draw_spectra</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">cannon_set</span> <span class="o">=</span> <span class="n">draw_spectra</span><span class="p">(</span><span class="n">model</span><span class="p">,</span> <span class="n">test_set</span><span class="p">)</span>
</pre></div>
</div>
<p>We can now perform a final set of diagnostic checks.</p>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="kn">from</span> <span class="nn">cannon_spectra</span> <span class="kn">import</span> <span class="n">diagnostics</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">diagnostics</span><span class="p">(</span><span class="n">cannon_set</span><span class="p">,</span> <span class="n">test_set</span><span class="p">,</span> <span class="n">model</span><span class="p">)</span>
</pre></div>
</div>
<p>The output of these diagnostics with sample plots are listed below.</p>
<ol class="arabic simple">
<li>A directory called SpectrumFits containing (for 10 randomly-selected stars)
the Cannon fitted spectra overlaid with the &#8216;true&#8217; (data) spectra,
as well as the two compared in a 1-to-1 plot.</li>
</ol>
<img alt="_images/Star500.png" src="_images/Star500.png" />
<ol class="arabic simple" start="2">
<li>For each label, the residuals of the spectra fits stacked and sorted
by that label. If the functional form of the model is comprehensive enough,
then this should look like noise and there should be no systematic structure.</li>
</ol>
<img alt="_images/residuals_sorted_by_logg.png" src="_images/residuals_sorted_by_logg.png" />
<ol class="arabic simple" start="3">
<li>The autocorrelation of the mean spectral residual. If the functional
form of the model is comprehensive enough, then this should be a delta
function.</li>
</ol>
<img alt="_images/residuals_autocorr.png" src="_images/residuals_autocorr.png" />
</div>
</div>
</div>


          </div>
        </div>
      </div>
      <div class="sphinxsidebar">
        <div class="sphinxsidebarwrapper">
  <h3><a href="#">Table Of Contents</a></h3>
  <ul>
<li><a class="reference internal" href="#"><em>The Cannon</em>: Data-Driven Stellar Labels</a><ul>
<li><a class="reference internal" href="#introduction">Introduction</a><ul>
<li><a class="reference internal" href="#introduction-to-the-cannon">Introduction to <em>The Cannon</em></a></li>
<li><a class="reference internal" href="#overview-of-the-cannon-software">Overview of <em>The Cannon</em> Software</a></li>
</ul>
</li>
<li><a class="reference internal" href="#using-the-cannon">Using <em>The Cannon</em></a><ul>
<li><a class="reference internal" href="#step-1-construct-a-training-set-from-apogee-files">Step 1: Construct a training set from APOGEE files</a><ul>
<li><a class="reference internal" href="#reading-spectra-get-spectra">Reading spectra (<tt class="docutils literal"><span class="pre">get_spectra</span></tt>)</a></li>
<li><a class="reference internal" href="#reading-labels-get-training-labels">Reading labels (<tt class="docutils literal"><span class="pre">get_training_labels</span></tt>)</a></li>
<li><a class="reference internal" href="#creating-tailoring-a-dataset-object-choose-labels-choose-spectra">Creating &amp; tailoring a <tt class="docutils literal"><span class="pre">Dataset</span></tt> object (<tt class="docutils literal"><span class="pre">choose_labels</span></tt>, <tt class="docutils literal"><span class="pre">choose_spectra</span></tt>)</a></li>
<li><a class="reference internal" href="#training-set-diagnostics-training-set-diagnostics">Training set diagnostics (training_set_diagnostics)</a></li>
</ul>
</li>
<li><a class="reference internal" href="#step-2-construct-a-test-set-from-apogee-files">Step 2: Construct a test set from APOGEE files</a></li>
<li><a class="reference internal" href="#step-3-the-cannon-step-1-fit-model-train-model-model-diagnostics">Step 3: <em>The Cannon</em> Step 1 - Fit Model (<tt class="docutils literal"><span class="pre">train_model</span></tt>, <tt class="docutils literal"><span class="pre">model_diagnostics</span></tt>)</a></li>
<li><a class="reference internal" href="#step-4-the-cannon-step-2-infer-labels-infer-labels-test-set-diagnostics">Step 4: <em>The Cannon</em> Step 2 - Infer Labels (<tt class="docutils literal"><span class="pre">infer_labels</span></tt>, <tt class="docutils literal"><span class="pre">test_set_diagnostics</span></tt>)</a></li>
<li><a class="reference internal" href="#cannon-spectra-draw-spectra-diagnostics">Cannon Spectra (<tt class="docutils literal"><span class="pre">draw_spectra</span></tt>, <tt class="docutils literal"><span class="pre">diagnostics</span></tt>)</a></li>
</ul>
</li>
</ul>
</li>
</ul>

  <h3>This Page</h3>
  <ul class="this-page-menu">
    <li><a href="_sources/index.txt"
           rel="nofollow">Show Source</a></li>
  </ul>
<div id="searchbox" style="display: none">
  <h3>Quick search</h3>
    <form class="search" action="search.html" method="get">
      <input type="text" name="q" />
      <input type="submit" value="Go" />
      <input type="hidden" name="check_keywords" value="yes" />
      <input type="hidden" name="area" value="default" />
    </form>
    <p class="searchtip" style="font-size: 90%">
    Enter search terms or a module, class or function name.
    </p>
</div>
<script type="text/javascript">$('#searchbox').show(0);</script>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="related">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="genindex.html" title="General Index"
             >index</a></li>
        <li><a href="#">TheCannon 1.0 documentation</a> &raquo;</li> 
      </ul>
    </div>
    <div class="footer">
        &copy; Copyright 2015, Anna Ho.
      Created using <a href="http://sphinx-doc.org/">Sphinx</a> 1.2.3.
    </div>
  </body>
</html>